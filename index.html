<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TailorPro - Gestion pour Couturiers</title>
    <meta name="description" content="Application de gestion pour couturiers au Cameroun, renomm√©e TailorPro.">
    <meta name="theme-color" content="#8a4fff">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icons/android-icon-192x192.png">
    <link rel="icon" href="icons/icon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="css/style.css">
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/6.1.0/firebase-ui-auth.css" />
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/components.css">
    <script src="js/components.js"></script>
    <script src="js/tests.js"></script>
</head>
<body>

    <!-- ==== √âCRAN DE CHARGEMENT GLOBAL ==== -->
    <div id="app-loader" class="app-loader" style="display: none;">
        <div class="loading-spinner"></div>
        <p>Chargement de votre espace de travail...</p>
    </div>

    <!-- ==== MODALE D'AUTHENTIFICATION ==== -->
    <div id="auth-modal" class="modal" style="display: none;">
        <div class="modal-content auth-modal-content">
            <span class="close-modal" style="color: red;" onclick="app.hideAuthModal()">&times;</span>
            <div class="logo-container" style="text-align: center; margin-bottom: 2rem;">
                <img src="icons/icon.svg" alt="TailorPro Logo" class="logo" width="80">
                <h1 style="color: #8a4fff; margin: 0.5rem 0;">TailorPro</h1>
                <p style="color: #666; margin: 0;">Gestion Simple pour Couturiers</p>
            </div>
            <div id="firebaseui-view" class="auth-view">
                <div id="firebaseui-auth-container"></div>
                <div class="auth-separator"><span>Ou</span></div>
                <div style="text-align: center;">
                    <button id="show-native-auth-btn" class="btn-secondary" style="width: 100%; color: red;">
                        üìß Utiliser email/mot de passe
                    </button>
                </div>
            </div>
            <div id="native-auth-view" class="auth-view" style="display: none;">
                <div id="login-view">
                    <h3 style="text-align: center; margin-bottom: 1.5rem;">Connexion</h3>
                    <form id="login-form">
                        <div class="form-group"><input type="email" id="email" placeholder="Adresse email" required></div>
                        <div class="form-group"><input type="password" id="password" placeholder="Mot de passe" required></div>
                        <button type="submit" id="login-btn" class="btn-primary" style="width: 100%;">Se connecter</button>
                    </form>
                    <div class="auth-links">
                        <a href="#" id="show-register-link">Cr√©er un compte</a>
                        <a href="#" id="show-reset-link">Mot de passe oubli√©?</a>
                    </div>
                </div>
                <div id="register-view" style="display: none;">
                    <h3 style="text-align: center; margin-bottom: 1.5rem;">Inscription</h3>
                    <form id="register-form">
                        <div class="form-group"><input type="email" id="register-email" placeholder="Adresse email" required></div>
                        <div class="form-group"><input type="password" id="register-password" placeholder="Mot de passe (6 caract√®res minimum)" required></div>
                        <button type="submit" id="register-btn" class="btn-primary" style="width: 100%;">S'inscrire</button>
                    </form>
                    <div class="auth-links"><a href="#" id="back-to-login-link">D√©j√† un compte? Se connecter</a></div>
                </div>
                <div id="reset-view" style="display: none;">
                    <h3 style="text-align: center; margin-bottom: 1.5rem;">R√©initialisation</h3>
                    <form id="reset-form">
                        <div class="form-group"><input type="email" id="reset-email" placeholder="Adresse email" required></div>
                        <button type="submit" id="reset-btn" class="btn-primary" style="width: 100%;">Envoyer le lien de r√©initialisation</button>
                    </form>
                    <div class="auth-links"><a href="#" id="back-to-login-from-reset">Retour √† la connexion</a></div>
                </div>
                <div style="text-align: center; margin-top: 1rem;">
                    <button id="back-to-firebaseui-btn" class="btn-secondary" style="width: 100%; color: blue;">
                        üîÑ Revenir √† la connexion rapide
                    </button>
                </div>
            </div>
            <div id="auth-message" class="auth-message"></div>
            <div id="auth-loading" style="display: none; text-align: center;">
                <div class="loading-spinner" style="margin: 0 auto;"></div>
                <p style="margin-top: 1rem;">Connexion en cours...</p>
            </div>
        </div>
    </div>

    <!-- ==== APPLICATION PRINCIPALE ==== -->
    <div id="app-container">
        <header>
            <div class="header-content" style="text-align:center">
                <div class="logo">
                    <img src="icons/icon.svg" alt="TailorPro" width="100%">
                    <h1>TailorPro Business Management</h1>
                    <p>Gestion Simple pour Couturiers</p>
                </div>
                <div id="user-info" class="user-info">
                    <span></span>
                    <button onclick="app.showAuthModal()" class="btn-primary">Se connecter</button>
                </div>
                <div id="business-collections-status"> </div>
                <div id="install-prompt" class="install-prompt" style="display: none;">
                    <div class="install-content">
                        <span class="close-install-prompt" onclick="dismissInstallPrompt()">&times;</span>
                        <h3>üì± Installer l'Application</h3>
                        <p>Installez l'application pour une exp√©rience optimale et l'acc√®s hors ligne.</p>
                        <div class="install-actions">
                            <button class="btn-primary install-btn" onclick="installApp()">
                                <span class="btn-icon">üì±</span> Installer
                            </button>
                            <button class="btn-secondary" onclick="dismissInstallPrompt()">
                                Plus tard
                            </button>
                        </div>
                        <div class="install-timer">Dispara√Æt dans <span id="install-timer-countdown">25</span>s</div>
                    </div>
                </div>
            </div>
        </header>

        <main>
            <nav>
                <ul>
                    <li><a href="#" class="nav-active" data-section="dashboard">üìä Tableau de bord</a></li>
                    <li><a href="#" data-section="clients">üë• Clients</a></li>
                    <li><a href="#" data-section="creations">üëó Cr√©ations</a></li>
                    <li><a href="#" data-section="orders">‚úÇÔ∏è Commandes</a></li>
                    <li><a href="#" data-section="measurements">üìè Mesures</a></li>
                    <li><a href="#" data-section="gallery">üñºÔ∏è Galerie</a></li>
                    <li><a href="#" data-section="finances">üí∞ Finances</a></li>
                    <li><a href="#" data-section="settings">‚öôÔ∏è Param√®tres</a></li>
                </ul>
            </nav>

            <section id="main-content">
                <div id="public-content" class="public-section"></div>
                <div id="premium-sections" class="premium-section" style="display: none;">
                    <div id="dashboard-section" class="content-section active">
                        <div class="section-header">
                            <h2 class="section-title">Tableau de Bord</h2>
                            <div class="premium-badge">‚≠ê Premium</div>
                        </div>
                        <div class="dashboard-grid">
                            <div class="stat-card"><div class="stat-label">Clients Actifs</div><div class="stat-number" id="clients-count">0</div><div class="stat-trend">Collection Clients</div></div>
                            <div class="stat-card"><div class="stat-label">Commandes en Cours</div><div class="stat-number" id="orders-count">0</div><div class="stat-trend">Collection Commandes</div></div>
                            <div class="stat-card"><div class="stat-label">Revenus du Mois</div><div class="stat-number" id="month-revenue">0 FCFA</div><div class="stat-trend">Donn√©es financi√®res</div></div>
                            <div class="stat-card"><div class="stat-label">Montants dus</div><div class="stat-number" id="amounts-due">0 FCFA</div><div class="stat-trend">√Ä recouvrer</div></div>
                        </div>
                        <div class="card">
                            <h3>Commandes R√©centes</h3>
                            <div class="table-container">
                                <table>
                                    <thead><tr><th>Client</th><th>Cr√©ation</th><th>Montant</th><th>Pay√©</th><th>Reste</th><th>Statut</th></tr></thead>
                                    <tbody id="recent-orders">
                                        <tr><td colspan="6" class="text-center empty-state"><div class="premium-placeholder"><p>Aucune commande r√©cente</p><button onclick="app.showTab('orders')" class="btn-secondary">Cr√©er votre premi√®re commande</button></div></td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div id="clients-section" class="content-section" style="width:100%;">
                        <div class="section-header">
                            <h2 class="section-title">Gestion des Clients</h2>
                            <div class="premium-badge">‚≠ê Premium</div>
                            <button class="btn btn-primary" onclick="window.modalManager.openModal('client')">+ Nouveau Client</button>
                        </div>
                        <div class="card">
                            <div class="table-container">
                                <table>
                                    <thead><tr><th>Nom</th><th>Pr√©nom</th><th>T√©l√©phone</th><th>Email</th><th>Actions</th></tr></thead>
                                    <tbody id="clients-list">
                                        <tr><td colspan="5" class="text-center empty-state"><div class="premium-placeholder"><p>Aucun client enregistr√©</p><button onclick="window.modalManager.openModal('client')" class="btn-secondary">Ajouter votre premier client</button></div></td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div id="creations-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">Gestion des Cr√©ations</h2>
                            <div class="premium-badge">‚≠ê Premium</div>
                            <button class="btn btn-primary" onclick="window.modalManager.openModal('creation')">+ Nouvelle Cr√©ation</button>
                        </div>
                        <div class="card"><div id="creations-grid" class="creations-grid"><div class="premium-placeholder"></div></div></div>
                    </div>
                    <div id="orders-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">Gestion des Commandes</h2>
                            <div class="premium-badge">‚≠ê Premium</div>
                            <button class="btn btn-primary" onclick="window.modalManager.openModal('order')">+ Nouvelle Commande</button>
                        </div>
                        <div class="card">
                            <div class="table-container">
                                <table>
                                    <thead><tr><th>Client</th><th>Cr√©ation</th><th>Date</th><th>Montant</th><th>Pay√©</th><th>Reste</th><th>Statut</th><th>Actions</th></tr></thead>
                                    <tbody id="orders-list">
                                        <tr><td colspan="8" class="text-center empty-state"><div class="premium-placeholder"><p>Aucune commande enregistr√©e</p><button onclick="window.modalManager.openModal('order')" class="btn-secondary">Cr√©er votre premi√®re commande</button></div></td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div id="measurements-section" class="content-section">
                        <div class="section-header"><h2 class="section-title">Gestion des Mesures</h2><div class="premium-badge">‚≠ê Premium</div></div>
                        <div id="measurements-container"></div>
                    </div>
                    <div id="gallery-section" class="content-section">
                        <div class="section-header"><h2 class="section-title">Galerie des Cr√©ations</h2><div class="premium-badge">‚≠ê Premium</div></div>
                        <div id="gallery-grid" class="creations-grid"></div>
                    </div>
                    <div id="finances-section" class="content-section">
                        <div class="section-header"><h2 class="section-title">Gestion Financi√®re</h2><div class="premium-badge">‚≠ê Premium</div></div>
                        <div id="financial-dashboard-container"></div>
                    </div>
                    <div id="settings-section" class="content-section">
                        <div class="section-header"><h2 class="section-title">Param√®tres</h2><div class="premium-badge">‚≠ê Premium</div></div>
                        <div class="card">
                            <div class="settings-grid">
                                <div class="setting-card">
                                    <h4>üìä Collections M√©tier</h4><p>Statut de vos collections de donn√©es</p>
                                    <div id="collections-status-panel"></div>
                                </div>
                                <div class="setting-card">
                                    <h4>‚òÅÔ∏è Synchronisation Cloud</h4><p>Statut de la connexion et sauvegarde</p>
                                    <div id="cloud-status" class="cloud-status cloud-disconnected"><span class="cloud-icon">‚òÅÔ∏è</span><span id="cloud-status-text">D√©connect√©</span></div>
                                    <div id="backup-info" class="backup-info">Dernier snapshot: Jamais</div>
                                </div>
                                <div class="setting-card">
                                    <h4>üç™ Gestion des Cookies</h4><p>Contr√¥lez vos pr√©f√©rences de confidentialit√©</p>
                                    <div class="cookie-settings-panel">
                                        <button onclick="app.showCookieModal()" class="btn-secondary" style="margin-top: 10px;">Modifier les pr√©f√©rences</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
        <div id="modal-container"></div>
        <div id="notification-container"></div>
    </div>
    
    <footer style="text-align: center; padding: 20px; margin-top: 40px; border-top: 1px solid #eee;">
        <p>
            <a href="terms-of-service.html">Conditions d'Utilisation</a> | 
            <a href="privacy-policy.html">Politique de Confidentialit√©</a> | 
            <a href="legal-notice.html">Mentions L√©gales</a> |
            <a href="javascript:void(0)" onclick="app.showCookieModal()">Gestion des Cookies</a>
        </p>
        <p>&copy; 2024 TailorPro. Tous droits r√©serv√©s.</p>
    </footer>
    
    <script src="https://www.gstatic.com/firebasejs/ui/6.1.0/firebase-ui-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <script src="js/firebase.js"></script>
    <script src="js/firebase-services.js"></script>
    <script src="js/ui/auth.js"></script>
    <script src="js/debug-auth.js"></script>
    <script src="js/measurements.js"></script>
    <script src="js/billing.js"></script>
    <script src="js/ui/mfa.js"></script>
    <script src="js/ui/render.js"></script>
    <script src="js/ui/modals.js"></script>
    <script src="js/pwa.js"></script>
    <script src="js/app.js"></script>
    <script src="js/init.js"></script>
    
    <script>
        window.addEventListener('load', () => {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('‚úÖ SW enregistr√©:', reg.scope))
                    .catch(err => console.error('‚ùå Erreur SW:', err));
            }
        });
    </script>
</body>
</html>